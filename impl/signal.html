
<!DOCTYPE html>

<html lang="zh">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>信号空间</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-examples.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="离散傅里叶变换" href="fft.html" />
    <link rel="prev" title="导言" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="zh">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint">⚠️The latest release refactored our HTML, so double-check your custom CSS rules!⚠️</div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  理论篇
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../theory/intro.html">
   分析架构
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../theory/signal.html">
   信号空间
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../theory/fft.html">
   快速傅里叶变换
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../theory/convolution.html">
   卷积
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../theory/wavelet.html">
   小波分析
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  实验篇
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../nb/intro.html">
   导言
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nb/signal.html">
   信号空间
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nb/fft.html">
   快速傅里叶变换
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nb/convolution.html">
   卷积
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../nb/wavelet.html">
   小波分析
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  实现篇
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   导言
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   信号空间
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="fft.html">
   离散傅里叶变换
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/blackgolfer/super-qi/szhq20022?urlpath=tree/ms/sp/impl/signal.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/blackgolfer/super-qi/blob/szhq20022/ms/sp/impl/signal.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
      <li>
        
<button onclick="initThebeSBT()"
  class="headerbtn headerbtn-launch-thebe"
  data-toggle="tooltip"
data-placement="left"
title="Launch Thebe"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="headerbtn__text-container">Live Code</span>
</button>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/blackgolfer/super-qi"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/blackgolfer/super-qi/issues/new?title=Issue%20on%20page%20%2Fimpl/signal.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/blackgolfer/super-qi/edit/szhq20022/ms/sp/impl/signal.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/impl/signal.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   信号空间
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#python-data-model">
     Python data model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nametuple">
       nametuple
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-pythonic-card-deck">
       a pythonic card deck
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#len">
       <code class="docutils literal notranslate">
        <span class="pre">
         __len__
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#getitem">
       <code class="docutils literal notranslate">
        <span class="pre">
         ___getitem__
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-special-methods-are-used">
       How special methods are used?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-signal-class">
   The Signal Class
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>信号空间</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   信号空间
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#python-data-model">
     Python data model
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#nametuple">
       nametuple
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-pythonic-card-deck">
       a pythonic card deck
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#len">
       <code class="docutils literal notranslate">
        <span class="pre">
         __len__
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#getitem">
       <code class="docutils literal notranslate">
        <span class="pre">
         ___getitem__
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-special-methods-are-used">
       How special methods are used?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-signal-class">
   The Signal Class
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="id1">
<h1>信号空间<a class="headerlink" href="#id1" title="永久链接至标题">#</a></h1>
<section id="python-data-model">
<h2>Python data model<a class="headerlink" href="#python-data-model" title="永久链接至标题">#</a></h2>
<p>You can think of the <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html">data model</a> as a description of Python as a framework. It formalizes the interfaces of the building blocks of the language itself, such as sequences, iterators, functions, classes, context managers, and so on.</p>
<p>While coding with any framework, you spend a lot of time implementing methods that are called by the framework. The same happens when you leverage the Python data model. The Python interpreter invokes special methods to perform basic object oper‐ ations, often triggered by special syntax. The special method names are always written with leading and trailing double underscores (i.e., <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>). For example, the syntax obj[key] is supported by the <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> special method. In order to evaluate <code class="docutils literal notranslate"><span class="pre">my_collection[key]</span></code>, the interpreter calls my_collection.<code class="docutils literal notranslate"><span class="pre">__getitem__(key)</span></code>.</p>
<p>The special method names allow your objects to implement, support, and interact with basic language constructs such as:</p>
<ul class="simple">
<li><p>Iteration</p></li>
<li><p>Collections</p></li>
<li><p>Attribute access</p></li>
<li><p>Operator overloading</p></li>
<li><p>Function and method invocation</p></li>
<li><p>Object creation and destruction</p></li>
<li><p>String representation and formatting</p></li>
<li><p>Manage context (i.e. with <em>blocks</em>)</p></li>
</ul>
<p>The following is a very simple example, but it demonstrates the power of implementing just two special methods, <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> and <code class="docutils literal notranslate"><span class="pre">__len__</span></code>.</p>
<section id="nametuple">
<h3>nametuple<a class="headerlink" href="#nametuple" title="永久链接至标题">#</a></h3>
<p><em>namedtuple</em> can be used to build classes of objects that are just bundles of attributes with no custom methods, like a database record. In the example, we use it to provide a nice representation for the cards in the deck, as shown in the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">collections</span>

<span class="n">Card</span><span class="o">=</span><span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Card&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rank&#39;</span><span class="p">,</span> <span class="s1">&#39;suit&#39;</span><span class="p">])</span>

<span class="n">Card</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;spades&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;2&#39;, suit=&#39;spades&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-pythonic-card-deck">
<h3>a pythonic card deck<a class="headerlink" href="#a-pythonic-card-deck" title="永久链接至标题">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FrenchDeck</span><span class="p">:</span>
    <span class="n">ranks</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">11</span><span class="p">)]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;JQKA&#39;</span><span class="p">)</span>
    <span class="n">suits</span> <span class="o">=</span> <span class="s1">&#39;spades diamonds clubs hearts&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cards</span><span class="o">=</span><span class="p">[</span><span class="n">Card</span><span class="p">(</span><span class="n">rank</span><span class="p">,</span><span class="n">suit</span><span class="p">)</span> <span class="k">for</span> <span class="n">suit</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">suits</span>
                                    <span class="k">for</span> <span class="n">rank</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranks</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cards</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cards</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="len">
<h3><code class="docutils literal notranslate"><span class="pre">__len__</span></code><a class="headerlink" href="#len" title="永久链接至标题">#</a></h3>
<p>First, like any standard Python collection, a deck responds to the <code class="docutils literal notranslate"><span class="pre">len()</span></code> function by returning the number of cards in it:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deck</span><span class="o">=</span><span class="n">FrenchDeck</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">deck</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>52
</pre></div>
</div>
</div>
</div>
</section>
<section id="getitem">
<h3><code class="docutils literal notranslate"><span class="pre">___getitem__</span></code><a class="headerlink" href="#getitem" title="永久链接至标题">#</a></h3>
<p>Reading specific cards from the deck—say, the first or the last—should be as easy as <code class="docutils literal notranslate"><span class="pre">deck[0]</span></code> or <code class="docutils literal notranslate"><span class="pre">deck[-1]</span></code>, and this is what the <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> method provides:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deck</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;2&#39;, suit=&#39;spades&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deck</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;A&#39;, suit=&#39;hearts&#39;)
</pre></div>
</div>
</div>
</div>
<p>Should we create a method to pick a random card? No need. Python already has a function to get a random item from a sequence: <code class="docutils literal notranslate"><span class="pre">random.choice</span></code>. We can just use it on a deck instance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">choice</span>

<span class="n">choice</span><span class="p">(</span><span class="n">deck</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;Q&#39;, suit=&#39;diamonds&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">choice</span><span class="p">(</span><span class="n">deck</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;5&#39;, suit=&#39;hearts&#39;)
</pre></div>
</div>
</div>
</div>
<p>We’ve just seen two advantages of using special methods to leverage the Python data model:</p>
<ul class="simple">
<li><p>The users of your classes don’t have to memorize arbitrary method names for stan‐ dard operations</p></li>
<li><p>It’s easier to benefit from the rich Python standard library and avoid reinventing the wheel, like the <code class="docutils literal notranslate"><span class="pre">random.choice</span></code> function.</p></li>
</ul>
<p>Because our <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> delegates to the <code class="docutils literal notranslate"><span class="pre">[]</span></code> operator of <code class="docutils literal notranslate"><span class="pre">self._cards</span></code>, our deck automatically supports <em>slicing</em>. Here’s how we look at the top three cards from a brand new deck, and then pick just the aces by starting on index <code class="docutils literal notranslate"><span class="pre">12</span></code> and skipping <code class="docutils literal notranslate"><span class="pre">13</span></code> cards at a time:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deck</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Card(rank=&#39;2&#39;, suit=&#39;spades&#39;),
 Card(rank=&#39;3&#39;, suit=&#39;spades&#39;),
 Card(rank=&#39;4&#39;, suit=&#39;spades&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">deck</span><span class="p">[</span><span class="mi">12</span><span class="p">::</span><span class="mi">13</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Card(rank=&#39;A&#39;, suit=&#39;spades&#39;),
 Card(rank=&#39;A&#39;, suit=&#39;diamonds&#39;),
 Card(rank=&#39;A&#39;, suit=&#39;clubs&#39;),
 Card(rank=&#39;A&#39;, suit=&#39;hearts&#39;)]
</pre></div>
</div>
</div>
</div>
<p>Just by implementing the <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> special method, our deck is also iterable:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="n">deck</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;2&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;3&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;4&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;5&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;6&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;7&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;8&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;9&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;10&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;J&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;K&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;A&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;2&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;3&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;4&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;5&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;6&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;7&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;8&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;9&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;10&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;J&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;K&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;A&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;2&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;3&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;4&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;5&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;6&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;7&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;8&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;9&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;10&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;J&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;K&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;A&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;2&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;3&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;4&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;5&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;6&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;7&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;8&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;9&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;10&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;J&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;K&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;A&#39;, suit=&#39;hearts&#39;)
</pre></div>
</div>
</div>
</div>
<p>The deck can also be iterated in reverse:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">deck</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;A&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;K&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;J&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;10&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;9&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;8&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;7&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;6&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;5&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;4&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;3&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;2&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;A&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;K&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;J&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;10&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;9&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;8&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;7&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;6&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;5&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;4&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;3&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;2&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;A&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;K&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;J&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;10&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;9&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;8&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;7&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;6&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;5&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;4&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;3&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;2&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;A&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;K&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;J&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;10&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;9&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;8&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;7&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;6&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;5&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;4&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;3&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;2&#39;, suit=&#39;spades&#39;)
</pre></div>
</div>
</div>
</div>
<p>Iteration is often implicit. If a collection has no <code class="docutils literal notranslate"><span class="pre">__contains__</span></code> method, the in operator does a sequential scan. Case in point: it works with our <code class="docutils literal notranslate"><span class="pre">FrenchDeck</span></code> class because it is iterable. Check it out:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Card</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;hearts&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">deck</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Card</span><span class="p">(</span><span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;beasts&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">deck</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>How about sorting? A common system of ranking cards is by rank (with aces being highest), then by suit in the order of spades (highest), then hearts, diamonds, and clubs (lowest). Here is a function that ranks cards by that rule, returning 0 for the 2 of clubs and 51 for the ace of spades:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">suit_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">spades</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hearts</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">diamonds</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clubs</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">spades_high</span><span class="p">(</span><span class="n">card</span><span class="p">):</span>
    <span class="n">rank_value</span> <span class="o">=</span> <span class="n">FrenchDeck</span><span class="o">.</span><span class="n">ranks</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">card</span><span class="o">.</span><span class="n">rank</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rank_value</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">suit_values</span><span class="p">)</span> <span class="o">+</span> <span class="n">suit_values</span><span class="p">[</span><span class="n">card</span><span class="o">.</span><span class="n">suit</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">card</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">deck</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">spades_high</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">card</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Card(rank=&#39;2&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;2&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;2&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;2&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;3&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;3&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;3&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;3&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;4&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;4&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;4&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;4&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;5&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;5&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;5&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;5&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;6&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;6&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;6&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;6&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;7&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;7&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;7&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;7&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;8&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;8&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;8&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;8&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;9&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;9&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;9&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;9&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;10&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;10&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;10&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;10&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;J&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;J&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;J&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;J&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;Q&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;K&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;K&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;K&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;K&#39;, suit=&#39;spades&#39;)
Card(rank=&#39;A&#39;, suit=&#39;clubs&#39;)
Card(rank=&#39;A&#39;, suit=&#39;diamonds&#39;)
Card(rank=&#39;A&#39;, suit=&#39;hearts&#39;)
Card(rank=&#39;A&#39;, suit=&#39;spades&#39;)
</pre></div>
</div>
</div>
</div>
<p>Although <code class="docutils literal notranslate"><span class="pre">FrenchDeck</span></code> implicitly inherits from object, its functionality is not inherited, but comes from leveraging the data model and composition. By implementing the spe‐ cial methods <code class="docutils literal notranslate"><span class="pre">__len__</span></code> and <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>, our <code class="docutils literal notranslate"><span class="pre">FrenchDeck</span></code> behaves like a standard Python sequence, allowing it to benefit from core language features (e.g., iteration and slicing) and from the standard library, as shown by the examples using <code class="docutils literal notranslate"><span class="pre">random.choice</span></code>, reversed, and sorted. Thanks to composition, the <code class="docutils literal notranslate"><span class="pre">__len__</span></code> and <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code> implementations can hand off all the work to a list object, <code class="docutils literal notranslate"><span class="pre">self._cards</span></code>.</p>
</section>
<section id="how-special-methods-are-used">
<h3>How special methods are used?<a class="headerlink" href="#how-special-methods-are-used" title="永久链接至标题">#</a></h3>
<p>The first thing to know about special methods is that they are meant to be called by the Python interpreter, and not by you. You don’t write <code class="docutils literal notranslate"><span class="pre">my_object.__len__()</span></code>. You write <code class="docutils literal notranslate"><span class="pre">len(my_object)</span></code> and, if <code class="docutils literal notranslate"><span class="pre">my_object</span></code> is an instance of a user-defined class, then Python calls the <code class="docutils literal notranslate"><span class="pre">__len__</span></code> instance method you implemented.</p>
<p>But for built-in types like <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">bytearray</span></code>, and so on, the interpreter takes a short‐cut: the CPython implementation of <code class="docutils literal notranslate"><span class="pre">len()</span></code> actually returns the value of the <code class="docutils literal notranslate"><span class="pre">ob_size</span></code> field in the PyVarObject C struct that represents any variable-sized built-in object in memory. This is much faster than calling a method.</p>
<p>More often than not, the special method call is implicit. For example, the statement <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">x:</span></code> actually causes the invocation of <code class="docutils literal notranslate"><span class="pre">iter(x)</span></code>, which in turn may call <code class="docutils literal notranslate"><span class="pre">x.__iter__()</span></code> if that is available.</p>
<p>Normally, your code should not have many direct calls to special methods. Unless you are doing a lot of metaprogramming, you should be implementing special methods more often than invoking them explicitly. The only special method that is frequently called by user code directly is <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, to invoke the initializer of the superclass in your own <code class="docutils literal notranslate"><span class="pre">__init__</span></code> implementation.</p>
<p>If you need to invoke a special method, it is usually better to call the related built-in function (e.g., <code class="docutils literal notranslate"><span class="pre">len</span></code>, <code class="docutils literal notranslate"><span class="pre">iter</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>, etc). These built-ins call the corresponding special method, but often provide other services and — for built-in types — are faster than method calls.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="the-signal-class">
<h1>The Signal Class<a class="headerlink" href="#the-signal-class" title="永久链接至标题">#</a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">qiplot</span>

<span class="k">def</span> <span class="nf">left_rotate</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">n</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">gcd</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">n</span><span class="p">)):</span>
         
        <span class="c1"># move i-th values of blocks</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">d</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">n</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="n">i</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">arr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">k</span>
        <span class="n">arr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>

<span class="c1"># the case of np=nn</span>
<span class="k">def</span> <span class="nf">order_indexes</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span><span class="n">m</span><span class="p">)</span>

<span class="c1"># assuming signal on the [0,1]</span>
<span class="c1"># padding zero to the left of the origin</span>
<span class="k">def</span> <span class="nf">pad_left</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">pad_size</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pad_size</span><span class="p">))</span>

<span class="c1"># assuming signal on the [-1,0]</span>
<span class="c1"># padding eor to the right of the origin</span>
<span class="k">def</span> <span class="nf">pad_right</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">pad_size</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">pad_size</span><span class="p">),</span><span class="n">sig</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">signal</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s1">&#39;mid&#39;</span> <span class="ow">or</span> <span class="nb">type</span><span class="o">==</span><span class="s1">&#39;grid&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">=</span><span class="nb">type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;invalid type&#39;</span><span class="p">)</span>
        <span class="n">is_sorted</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_sorted</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;time stamp not in order&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">==</span><span class="s1">&#39;mid&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_nn</span> <span class="c1"># number of positive t sampled points</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="o">=</span><span class="n">t</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
    
    <span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
        <span class="n">left_rotate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">order_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type</span><span class="o">==</span><span class="s1">&#39;mid&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="p">))</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_nn</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_np</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>
    
    <span class="k">def</span> <span class="nf">t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_t</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="p">):</span>
        <span class="n">qiplot</span><span class="o">.</span><span class="n">plot_ts</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_t</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">order_index</span><span class="p">()])</span>

</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>  
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;../../../src/python/signal&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">qiplot</span> <span class="kn">import</span> <span class="n">plot_ts</span>
<span class="kn">import</span> <span class="nn">qisignal</span>
<span class="kn">from</span> <span class="nn">qisignal</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">([</span><span class="s1">&#39;ggplot&#39;</span><span class="p">,</span><span class="s1">&#39;../../presentation.mplstyle&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span> <span class="k">if</span> <span class="n">v</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sig</span><span class="o">=</span><span class="n">signal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/signal_37_0.png" src="../_images/signal_37_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sig</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/signal_39_0.png" src="../_images/signal_39_0.png" />
</div>
</div>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "blackgolfer/super-qi",
            ref: "szhq20022",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./impl"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="intro.html" title="上一页 页">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">上一页</p>
            <p class="prev-next-title">导言</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="fft.html" title="下一页 页">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">下一页</p>
        <p class="prev-next-title">离散傅里叶变换</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By 张志峰<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>